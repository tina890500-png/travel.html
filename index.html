<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<title>æˆ‘çš„æ—…éŠè³‡æ–™ï¼ˆé›²ç«¯åŒæ­¥ï¼‰</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Excel è§£æ -->
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<!-- Firebase SDK (CDN) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import {
    getFirestore, collection, addDoc,
    onSnapshot, deleteDoc, doc, updateDoc
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  /* ğŸ”´ Firebase è¨­å®šï¼ˆä½ å·²ç¶“æ‹¿åˆ°çš„é‚£ä¸€æ®µï¼‰ */
  const firebaseConfig = {
    apiKey: "AIzaSy......",
    authDomain: "travel-plan-80111.firebaseapp.com",
    projectId: "travel-plan-80111",
    storageBucket: "travel-plan-80111.firebasestorage.app",
    messagingSenderId: "598566081827",
    appId: "1:598566081827:web:57aeb8f456a0c37b1be896"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const colRef = collection(db, "trips");

  /* å³æ™‚åŒæ­¥é¡¯ç¤º */
  onSnapshot(colRef, snapshot => {
    const list = document.getElementById("list");
    list.innerHTML = "";

    snapshot.docs
      .map(d => ({ id: d.id, ...d.data() }))
      .sort((a, b) => (b.date || "").localeCompare(a.date || ""))
      .forEach(d => {
        list.innerHTML += `
          <div class="card">
            <h3>${d.title || ""}</h3>
            <div class="meta">${d.location || ""}</div>
            <div class="date">âœ” å·²åˆ°è¨ªï¼š${d.date || ""}</div>
            <div class="note">${d.note || ""}</div>
            <div class="actions">
              <button onclick="editTrip('${d.id}', '${d.note || ""}')">âœï¸ ç·¨è¼¯</button>
              <button onclick="deleteTrip('${d.id}')">ğŸ—‘ åˆªé™¤</button>
            </div>
          </div>
        `;
      });
  });

  /* æ–°å¢ */
  window.addTrip = async () => {
    if (!title.value.trim()) {
      alert("è«‹è¼¸å…¥åœ°é»åç¨±");
      return;
    }
    await addDoc(colRef, {
      title: title.value.trim(),
      location: location.value.trim(),
      date: date.value,
      note: note.value.trim()
    });
    title.value = location.value = date.value = note.value = "";
  };

  /* åˆªé™¤ */
  window.deleteTrip = async id => {
    if (confirm("ç¢ºå®šè¦åˆªé™¤é€™ç­†è³‡æ–™å—ï¼Ÿ")) {
      await deleteDoc(doc(db, "trips", id));
    }
  };

  /* ç·¨è¼¯ï¼ˆå…ˆåšå‚™è¨»å³å¯ï¼Œä¹‹å¾Œå¯å†æ“´å……ï¼‰ */
  window.editTrip = async (id, oldNote) => {
    const newNote = prompt("è«‹è¼¸å…¥æ–°çš„å‚™è¨»å…§å®¹ï¼š", oldNote);
    if (newNote !== null) {
      await updateDoc(doc(db, "trips", id), { note: newNote });
    }
  };

  /* Excel åŒ¯å…¥ */
  window.importExcel = () => {
    const file = document.getElementById("excel").files[0];
    if (!file) {
      alert("è«‹å…ˆé¸æ“‡ Excel æª”æ¡ˆ");
      return;
    }

    const reader = new FileReader();
    reader.onload = async e => {
      const wb = XLSX.read(e.target.result, { type: "binary" });
      const sheet = wb.Sheets[wb.SheetNames[0]];
      const rows = XLSX.utils.sheet_to_json(sheet);

      if (!rows.length) {
        alert("Excel æ²’æœ‰è³‡æ–™");
        return;
      }

      for (const r of rows) {
        await addDoc(colRef, {
          title: r["åœ°é»åç¨±"] || r["title"] || "",
          location: r["åœ°å€"] || r["location"] || "",
          date: (r["å·²åˆ°è¨ª"] || r["date"] || "").toString().slice(0, 10),
          note: r["å‚™è¨»"] || r["note"] || ""
        });
      }

      alert("Excel åŒ¯å…¥å®Œæˆï¼");
    };
    reader.readAsBinaryString(file);
  };
</script>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background: #f5f6f7;
  padding: 16px;
  margin: 0;
}
h1 {
  text-align: center;
  margin-bottom: 16px;
}
.card {
  background: #fff;
  border-radius: 14px;
  padding: 16px;
  margin-bottom: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,.08);
}
input, textarea {
  width: 100%;
  padding: 8px;
  margin: 6px 0;
  box-sizing: border-box;
}
button {
  padding: 6px 10px;
  margin-right: 6px;
}
.meta {
  color: #666;
}
.date {
  color: #0a7;
  font-size: 14px;
}
.note {
  margin-top: 8px;
  white-space: pre-wrap;
}
.actions {
  margin-top: 10px;
}
</style>
</head>

<body>

<h1>ğŸ“ æˆ‘çš„æ—…éŠè³‡æ–™ï¼ˆé›²ç«¯åŒæ­¥ï¼‰</h1>

<div class="card">
  <input id="title" placeholder="åœ°é»åç¨±">
  <input id="location" placeholder="åœ°å€ï¼ˆå¦‚ï¼šæ¡ƒåœ’ / æ—¥æœ¬ / æ¿Ÿå·ï¼‰">
  <input id="date" type="date">
  <textarea id="note" placeholder="å‚™è¨»"></textarea>
  <button onclick="addTrip()">â• æ–°å¢</button>
</div>

<div class="card">
  <input type="file" id="excel" accept=".xlsx,.csv">
  <button onclick="importExcel()">ğŸ“¤ åŒ¯å…¥ Excel</button>
</div>

<div id="list"></div>

</body>
</html>
