<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>æ—…éŠè³‡æ–™æ”¶é›†ç°¿</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:#f5f7fa;
  padding:20px;
}
h1{text-align:center;}
.card{
  background:#fff;
  padding:16px;
  border-radius:14px;
  margin-bottom:18px;
  box-shadow:0 2px 8px rgba(0,0,0,.08);
}
.tabs{text-align:center;margin-bottom:12px;}
.tab{
  display:inline-block;
  padding:6px 14px;
  margin:4px;
  border-radius:20px;
  background:#e0e0e0;
  cursor:pointer;
}
.tab.active{background:#4caf50;color:#fff;}
label{font-weight:bold;display:block;margin-top:10px;}
input,textarea,select{
  width:100%;
  padding:8px;
  margin-top:4px;
  border-radius:6px;
  border:1px solid #ccc;
}
button{
  width:100%;
  padding:12px;
  margin-top:14px;
  background:#4caf50;
  color:#fff;
  border:none;
  border-radius:10px;
  font-size:16px;
  cursor:pointer;
}
button.secondary{background:#607d8b;}
.item{
  border-bottom:1px dashed #ddd;
  padding:10px 0;
}
.badge{font-size:12px;color:#666;}
.date{
  color:#2e7d32;
  font-weight:bold;
}
.actions{
  font-size:13px;
  margin-top:6px;
}
.actions span{
  cursor:pointer;
  margin-right:10px;
  color:#d32f2f;
}
</style>
</head>

<body>

<h1>ğŸŒ æ—…éŠè³‡æ–™æ”¶é›†ç°¿</h1>

<div class="tabs">
  <span class="tab active" onclick="setTab('all',this)">å…¨éƒ¨</span>
  <span class="tab" onclick="setTab('domestic',this)">åœ‹å…§</span>
  <span class="tab" onclick="setTab('foreign',this)">åœ‹å¤–</span>
  <span class="tab" onclick="setTab('visited',this)">å·²åˆ°è¨ª</span>
  <span class="tab" onclick="setTab('unvisited',this)">æœªåˆ°è¨ª</span>
</div>

<div class="card">
  <label>åœ°å€é¡å‹</label>
  <select id="area">
    <option>åœ‹å…§</option>
    <option>åœ‹å¤–</option>
  </select>

  <label>åœ‹å®¶ / ç¸£å¸‚é„‰é®</label>
  <input id="place">

  <label>æ¨™é¡Œ</label>
  <input id="title">

  <label>è³‡æ–™å…§å®¹</label>
  <textarea id="content"></textarea>

  <label>åƒè€ƒç¶²å€</label>
  <textarea id="links"></textarea>

  <label>æ˜¯å¦å·²åˆ°è¨ª</label>
  <select id="visited">
    <option value="å¦">å¦</option>
    <option value="æ˜¯">æ˜¯</option>
  </select>

  <label>åˆ°è¨ªæ—¥æœŸ</label>
  <input type="date" id="date">

  <button onclick="save()">ğŸ’¾ å„²å­˜</button>
</div>

<div class="card">
  <button class="secondary" onclick="exportCSV()">ğŸ“¤ åŒ¯å‡º Excelï¼ˆCSVï¼‰</button>
  <button class="secondary" onclick="document.getElementById('importFile').click()">ğŸ“¥ åŒ¯å…¥ Excelï¼ˆCSVï¼‰</button>
  <input type="file" id="importFile" accept=".csv" style="display:none" onchange="importCSV()">
</div>

<div class="card">
  <h2>ğŸ“š æˆ‘çš„æ—…éŠè³‡æ–™</h2>
  <div id="list"></div>
</div>

<script>
let currentTab="all";

function setTab(tab,el){
  currentTab=tab;
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  render();
}

/* yyyy-mm-dd â†’ yyyy/mm/dd */
function formatDate(d){
  return d ? d.replaceAll("-","/") : "";
}

function save(){
  const id="travel-"+Date.now();
  const data={
    id,
    area:area.value,
    place:place.value,
    title:title.value,
    content:content.value,
    links:links.value,
    visited:visited.value,
    date:date.value
  };
  localStorage.setItem(id,JSON.stringify(data));

  // æ¸…ç©ºæ¬„ä½
  area.value="åœ‹å…§";
  place.value="";
  title.value="";
  content.value="";
  links.value="";
  visited.value="å¦";
  date.value="";

  render();
}

function render(){
  list.innerHTML="";
  let items=[];
  for(let k in localStorage){
    if(k.startsWith("travel-")){
      items.push(JSON.parse(localStorage[k]));
    }
  }

  // é ç±¤éæ¿¾
  items = items.filter(d=>{
    if(currentTab==="domestic") return d.area==="åœ‹å…§";
    if(currentTab==="foreign") return d.area==="åœ‹å¤–";
    if(currentTab==="visited") return d.visited==="æ˜¯";
    if(currentTab==="unvisited") return d.visited==="å¦";
    return true;
  });

  // â­ æ’åºæ ¸å¿ƒé‚è¼¯
  items.sort((a,b)=>{
    if(a.visited==="æ˜¯" && b.visited==="æ˜¯"){
      return new Date(b.date) - new Date(a.date); // æœ€æ–°åœ¨å‰
    }
    if(a.visited==="æ˜¯") return -1;
    if(b.visited==="æ˜¯") return 1;
    return 0;
  });

  items.forEach(d=>{
    list.innerHTML += `
    <div class="item">
      <b>${d.title||""}</b><br>
      <span class="badge">${d.area}ï½œ${d.place}</span><br>
      ${
        d.visited==="æ˜¯" && d.date
        ? `<span class="date">âœ” å·²åˆ°è¨ªï¼š${formatDate(d.date)}</span><br>`
        : ""
      }
      ${d.content||""}<br>
      ${d.links ? `<a href="${d.links}" target="_blank">ğŸ”— é€£çµ</a>` : ""}
      <div class="actions">
        <span onclick="removeItem('${d.id}')">ğŸ—‘ åˆªé™¤</span>
      </div>
    </div>`;
  });
}

function removeItem(id){
  if(confirm("ç¢ºå®šåˆªé™¤ï¼Ÿ")){
    localStorage.removeItem(id);
    render();
  }
}

/* åŒ¯å‡º Excelï¼ˆCSVï¼ŒUTF-8 ä¸äº‚ç¢¼ï¼‰ */
function exportCSV(){
  let rows=[["area","place","title","content","links","visited","date"]];
  for(let k in localStorage){
    if(k.startsWith("travel-")){
      const d=JSON.parse(localStorage[k]);
      rows.push([
        d.area,d.place,d.title,d.content,d.links,d.visited,d.date
      ]);
    }
  }

  const csv = rows.map(r =>
    r.map(v => `"${(v||"").replace(/"/g,'""')}"`).join(",")
  ).join("\n");

  const blob=new Blob(
    ["\ufeff"+csv],
    {type:"text/csv;charset=utf-8;"}
  );

  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="travel_backup.csv";
  a.click();
}

/* åŒ¯å…¥ Excelï¼ˆCSVï¼‰ */
function importCSV(){
  const file=importFile.files[0];
  if(!file)return;
  const reader=new FileReader();
  reader.onload=e=>{
    const lines=e.target.result.split("\n").slice(1);
    lines.forEach(l=>{
      if(!l.trim())return;
      const c=l.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g)
        .map(s=>s.replace(/^"|"$/g,"").replace(/""/g,'"'));
      const id="travel-"+Date.now()+Math.random();
      localStorage.setItem(id,JSON.stringify({
        id,
        area:c[0],
        place:c[1],
        title:c[2],
        content:c[3],
        links:c[4],
        visited:c[5],
        date:c[6]
      }));
    });
    render();
  };
  reader.readAsText(file,"utf-8");
}

render();
</script>

</body>
</html>
