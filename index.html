<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>æ—…éŠè³‡æ–™æ”¶é›†ç°¿</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:#f5f7fa;
  padding:20px;
}
h1{text-align:center;}
.card{
  background:#fff;
  padding:16px;
  border-radius:14px;
  margin-bottom:18px;
  box-shadow:0 2px 8px rgba(0,0,0,.08);
}
.tabs{text-align:center;margin-bottom:12px;}
.tab{
  display:inline-block;
  padding:6px 14px;
  margin:4px;
  border-radius:20px;
  background:#e0e0e0;
  cursor:pointer;
}
.tab.active{background:#4caf50;color:#fff;}
label{font-weight:bold;display:block;margin-top:10px;}
input,textarea,select{
  width:100%;padding:8px;margin-top:4px;
  border-radius:6px;border:1px solid #ccc;
}
button{
  width:100%;
  padding:12px;
  margin-top:14px;
  background:#4caf50;
  color:#fff;
  border:none;
  border-radius:10px;
  font-size:16px;
  cursor:pointer;
}
button.secondary{background:#607d8b;}
.item{
  border-bottom:1px dashed #ddd;
  padding:10px 0;
}
.badge{font-size:12px;color:#666;}
.date{color:#2e7d32;font-weight:bold;}
.actions{font-size:13px;margin-top:6px;}
.actions span{cursor:pointer;margin-right:12px;}
.edit{color:#1976d2;}
.delete{color:#d32f2f;}
.links a{
  margin-right:10px;
  font-size:13px;
}
.editing{
  background:#fffde7;
  border:2px solid #fbc02d;
}
</style>
</head>

<body>

<h1>ğŸŒ æ—…éŠè³‡æ–™æ”¶é›†ç°¿</h1>

<div class="tabs">
  <span class="tab active" onclick="setTab('all',this)">å…¨éƒ¨</span>
  <span class="tab" onclick="setTab('domestic',this)">åœ‹å…§</span>
  <span class="tab" onclick="setTab('foreign',this)">åœ‹å¤–</span>
  <span class="tab" onclick="setTab('visited',this)">å·²åˆ°è¨ª</span>
  <span class="tab" onclick="setTab('unvisited',this)">æœªåˆ°è¨ª</span>
</div>

<div class="card" id="formCard">
  <label>åœ°å€é¡å‹</label>
  <select id="area">
    <option>åœ‹å…§</option>
    <option>åœ‹å¤–</option>
  </select>

  <label>åœ‹å®¶ / ç¸£å¸‚é„‰é®</label>
  <input id="place">

  <label>æ¨™é¡Œ</label>
  <input id="title">

  <label>è³‡æ–™å…§å®¹</label>
  <textarea id="content"></textarea>

  <label>åƒè€ƒç¶²å€ï¼ˆå¯å¤šè¡Œï¼‰</label>
  <textarea id="links" placeholder="ä¸€è¡Œä¸€å€‹ç¶²å€"></textarea>

  <label>æ˜¯å¦å·²åˆ°è¨ª</label>
  <select id="visited">
    <option value="å¦">å¦</option>
    <option value="æ˜¯">æ˜¯</option>
  </select>

  <label>åˆ°è¨ªæ—¥æœŸ</label>
  <input type="date" id="date">

  <button onclick="save()">ğŸ’¾ å„²å­˜</button>
</div>

<div class="card">
  <button class="secondary" onclick="exportCSV()">ğŸ“¤ åŒ¯å‡º Excelï¼ˆCSVï¼‰</button>
  <button class="secondary" onclick="document.getElementById('importFile').click()">ğŸ“¥ åŒ¯å…¥ Excelï¼ˆCSVï¼‰</button>
  <input type="file" id="importFile" accept=".csv" style="display:none" onchange="importCSV()">
</div>

<div class="card">
  <h2>ğŸ“š æˆ‘çš„æ—…éŠè³‡æ–™</h2>
  <div id="list"></div>
</div>

<script>
let currentTab="all";
let editingId=null;

function setTab(tab,el){
  currentTab=tab;
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  render();
}

function formatDate(d){
  return d ? d.replaceAll("-","/") : "";
}

/* å°‡å¤šç¶²å€è½‰æˆé€£çµ */
function renderLinks(text){
  if(!text) return "";
  const urls = text.split(/\s+/).filter(Boolean);
  return `<div class="links">` + urls.map((u,i)=>
    `<a href="${u}" target="_blank">ğŸ”— é€£çµ${i+1}</a>`
  ).join("") + `</div>`;
}

/* å„²å­˜ï¼ˆæ–°å¢ / ç·¨è¼¯ï¼‰ */
function save(){
  const id = editingId || ("travel-"+Date.now());
  const data={
    id,
    area:area.value,
    place:place.value,
    title:title.value,
    content:content.value,
    links:links.value,
    visited:visited.value,
    date:date.value
  };
  localStorage.setItem(id,JSON.stringify(data));
  clearForm();
  render();
}

function clearForm(){
  editingId=null;
  formCard.classList.remove("editing");
  area.value="åœ‹å…§";
  place.value="";
  title.value="";
  content.value="";
  links.value="";
  visited.value="å¦";
  date.value="";
}

function editItem(id){
  const d=JSON.parse(localStorage.getItem(id));
  editingId=id;
  formCard.classList.add("editing");
  area.value=d.area;
  place.value=d.place;
  title.value=d.title;
  content.value=d.content;
  links.value=d.links;
  visited.value=d.visited;
  date.value=d.date;
  window.scrollTo({top:0,behavior:"smooth"});
}

function removeItem(id){
  if(confirm("ç¢ºå®šåˆªé™¤ï¼Ÿ")){
    localStorage.removeItem(id);
    render();
  }
}

function render(){
  list.innerHTML="";
  let items=[];
  for(let k in localStorage){
    if(k.startsWith("travel-")){
      items.push(JSON.parse(localStorage[k]));
    }
  }

  items = items.filter(d=>{
    if(currentTab==="domestic") return d.area==="åœ‹å…§";
    if(currentTab==="foreign") return d.area==="åœ‹å¤–";
    if(currentTab==="visited") return d.visited==="æ˜¯";
    if(currentTab==="unvisited") return d.visited==="å¦";
    return true;
  });

  items.sort((a,b)=>{
    if(a.visited==="æ˜¯" && b.visited==="æ˜¯"){
      return new Date(b.date)-new Date(a.date);
    }
    if(a.visited==="æ˜¯") return -1;
    if(b.visited==="æ˜¯") return 1;
    return 0;
  });

  items.forEach(d=>{
    list.innerHTML+=`
    <div class="item">
      <b>${d.title||""}</b><br>
      <span class="badge">${d.area}ï½œ${d.place}</span><br>
      ${
        d.visited==="æ˜¯" && d.date
        ? `<span class="date">âœ” å·²åˆ°è¨ªï¼š${formatDate(d.date)}</span><br>`
        : ""
      }
      ${d.content||""}
      ${renderLinks(d.links)}
      <div class="actions">
        <span c
