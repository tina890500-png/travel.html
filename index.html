<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>æ—…éŠè³‡æ–™æ”¶é›†ç°¿</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;background:#f5f7fa;padding:20px}
h1{text-align:center}
.card{background:#fff;padding:16px;border-radius:14px;margin-bottom:16px;box-shadow:0 2px 8px rgba(0,0,0,.08)}
.tabs{text-align:center;margin-bottom:10px}
.tab{display:inline-block;padding:6px 14px;margin:4px;border-radius:20px;background:#e0e0e0;cursor:pointer}
.tab.active{background:#4caf50;color:#fff}
label{font-weight:bold;display:block;margin-top:10px}
input,textarea,select{width:100%;padding:8px;border-radius:6px;border:1px solid #ccc;margin-top:4px}
button{width:100%;padding:12px;margin-top:14px;background:#4caf50;color:#fff;border:none;border-radius:10px;font-size:16px;cursor:pointer}
button.secondary{background:#607d8b}
.item{border-bottom:1px dashed #ddd;padding:10px 0}
.badge{font-size:12px;color:#666}
.date{color:#2e7d32;font-weight:bold}
.actions span{cursor:pointer;margin-right:12px;font-size:13px}
.edit{color:#1976d2}
.delete{color:#d32f2f}
.links a{margin-right:10px;font-size:13px}
.editing{border:2px solid #fbc02d;background:#fffde7}
</style>
</head>

<body>

<h1>ğŸŒ æ—…éŠè³‡æ–™æ”¶é›†ç°¿</h1>

<div class="tabs">
  <span class="tab active" data-tab="all">å…¨éƒ¨</span>
  <span class="tab" data-tab="domestic">åœ‹å…§</span>
  <span class="tab" data-tab="foreign">åœ‹å¤–</span>
  <span class="tab" data-tab="visited">å·²åˆ°è¨ª</span>
  <span class="tab" data-tab="unvisited">æœªåˆ°è¨ª</span>
</div>

<div class="card" id="formCard">
  <label>åœ°å€é¡å‹</label>
  <select id="area">
    <option>åœ‹å…§</option>
    <option>åœ‹å¤–</option>
  </select>

  <label>åœ‹å®¶ / ç¸£å¸‚é„‰é®</label>
  <input id="place">

  <label>æ¨™é¡Œ</label>
  <input id="title">

  <label>è³‡æ–™å…§å®¹</label>
  <textarea id="content"></textarea>

  <label>åƒè€ƒç¶²å€ï¼ˆå¯å¤šè¡Œï¼‰</label>
  <textarea id="links"></textarea>

  <label>æ˜¯å¦å·²åˆ°è¨ª</label>
  <select id="visited">
    <option value="å¦">å¦</option>
    <option value="æ˜¯">æ˜¯</option>
  </select>

  <label>åˆ°è¨ªæ—¥æœŸ</label>
  <input type="date" id="date">

  <button onclick="save()">ğŸ’¾ å„²å­˜</button>
</div>

<div class="card">
  <button class="secondary" onclick="exportCSV()">ğŸ“¤ åŒ¯å‡º Excelï¼ˆCSVï¼‰</button>
  <button class="secondary" onclick="document.getElementById('importFile').click()">ğŸ“¥ åŒ¯å…¥ Excelï¼ˆCSVï¼‰</button>
  <input type="file" id="importFile" accept=".csv" style="display:none" onchange="importCSV()">
</div>

<div class="card">
  <h2>ğŸ“š æˆ‘çš„æ—…éŠè³‡æ–™</h2>
  <div id="list"></div>
</div>

<script>
let currentTab="all";
let editingId=null;

document.querySelectorAll(".tab").forEach(t=>{
  t.onclick=()=>{document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));t.classList.add("active");currentTab=t.dataset.tab;render();}
});

function save(){
  const id = editingId || "travel-"+Date.now();
  const data={id,area:area.value,place:place.value,title:title.value,content:content.value,links:links.value,visited:visited.value,date:date.value};
  localStorage.setItem(id,JSON.stringify(data));
  clearForm();
  render();
}

function clearForm(){
  editingId=null;
  formCard.classList.remove("editing");
  ["place","title","content","links","date"].forEach(id=>document.getElementById(id).value="");
  area.value="åœ‹å…§";visited.value="å¦";
}

function renderLinks(text){
  if(!text) return "";
  const urls=text.split(/\s+/).filter(Boolean);
  return `<div class="links">`+urls.map((u,i)=>`<a href="${u}" target="_blank">ğŸ”— é€£çµ${i+1}</a>`).join("")+`</div>`;
}

function editItem(id){
  const d=JSON.parse(localStorage.getItem(id));
  editingId=id;
  formCard.classList.add("editing");
  Object.keys(d).forEach(k=>{if(document.getElementById(k))document.getElementById(k).value=d[k];});
  window.scrollTo({top:0,behavior:"smooth"});
}

function removeItem(id){
  if(confirm("ç¢ºå®šåˆªé™¤ï¼Ÿ")){localStorage.removeItem(id);render();}
}

function render(){
  list.innerHTML="";
  let items=[];
  Object.keys(localStorage).forEach(k=>{if(k.startsWith("travel-"))items.push(JSON.parse(localStorage[k]));});

  items=items.filter(d=>{
    if(currentTab==="domestic") return d.area==="åœ‹å…§";
    if(currentTab==="foreign") return d.area==="åœ‹å¤–";
    if(currentTab==="visited") return d.visited==="æ˜¯";
    if(currentTab==="unvisited") return d.visited==="å¦";
    return true;
  });

  items.sort((a,b)=>new Date(b.date||0)-new Date(a.date||0));

  items.forEach(d=>{
    list.innerHTML+=`
    <div class="item">
      <b>${d.title||""}</b><br>
      <span class="badge">${d.area}ï½œ${d.place}</span><br>
      ${d.visited==="æ˜¯"&&d.date?`<span class="date">âœ” å·²åˆ°è¨ªï¼š${d.date.replaceAll("-","/")}</span><br>`:""}
      ${d.content||""}
      ${renderLinks(d.links)}
      <div class="actions">
        <span class="edit" onclick="editItem('${d.id}')">âœï¸ ç·¨è¼¯</span>
        <span class="delete" onclick="removeItem('${d.id}')">ğŸ—‘ åˆªé™¤</span>
      </div>
    </div>`;
  });
}

function exportCSV(){
  let rows=[["area","place","title","content","links","visited","date"]];
  Object.keys(localStorage).forEach(k=>{
    if(k.startsWith("travel-")){
      const d=JSON.parse(localStorage[k]);
      rows.push([d.area,d.place,d.title,d.content,d.links,d.visited,d.date]);
    }
  });
  const csv=rows.map(r=>r.map(v=>`"${(v||"").replace(/"/g,'""')}"`).join(",")).join("\n");
  const blob=new Blob(["\ufeff"+csv],{type:"text/csv;charset=utf-8"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="travel_backup.csv";
  a.click();
}

function importCSV(){
  const f=importFile.files[0];if(!f)return;
  const r=new FileReader();
  r.onload=e=>{
    e.target.result.split("\n").slice(1).forEach(l=>{
      if(!l.trim())return;
      const c=l.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g).map(s=>s.replace(/^"|"$/g,""));
      localStorage.setItem("travel-"+Date.now()+Math.random(),JSON.stringify({id:"",area:c[0],place:c[1],title:c[2],content:c[3],links:c[4],visited:c[5],date:c[6]}));
    });
    render();
  };
  r.readAsText(f,"utf-8");
}

render();
</script>

</body>
</html>
