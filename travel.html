<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ—…éŠè³‡æ–™æ”¶é›†ç°¿</title>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;background:#f4f5f7;padding:16px;}
h1{text-align:center;}
.tab{display:inline-block;padding:6px 12px;margin:4px;border-radius:20px;background:#e0e0e0;cursor:pointer;}
.tab.active{background:#4CAF50;color:#fff;}
.card{background:#fff;border-radius:12px;padding:16px;margin-bottom:16px;box-shadow:0 2px 6px rgba(0,0,0,.08);}
label{font-weight:bold;display:block;margin-top:10px;}
input,select,textarea{width:100%;padding:8px;margin-top:4px;border-radius:6px;border:1px solid #ccc;}
button{margin-top:10px;padding:10px;width:100%;border:none;border-radius:8px;background:#4CAF50;color:#fff;font-size:16px;}
.item{border-bottom:1px dashed #ddd;padding:12px 0;font-size:14px;}
.tag{background:#e0f2f1;padding:2px 6px;border-radius:6px;margin-right:4px;font-size:12px;}
.small{font-size:12px;color:#555;}
.action{cursor:pointer;margin-right:8px;color:#1976d2;}
#saveMsg{display:none;text-align:center;color:#2e7d32;font-weight:bold;margin-bottom:10px;}
.date{font-size:12px;color:#444;margin-left:6px;}
</style>
</head>

<body>

<h1>ğŸŒ æ—…éŠè³‡æ–™æ”¶é›†ç°¿</h1>
<div id="saveMsg">âœ… å·²å„²å­˜</div>

<div style="text-align:center">
  <span class="tab active" onclick="setTab('all',this)">å…¨éƒ¨</span>
  <span class="tab" onclick="setTab('åœ‹å…§',this)">åœ‹å…§</span>
  <span class="tab" onclick="setTab('åœ‹å¤–',this)">åœ‹å¤–</span>
  <span class="tab" onclick="setTab('æ˜¯',this)">å·²åˆ°è¨ª</span>
  <span class="tab" onclick="setTab('å¦',this)">æœªåˆ°è¨ª</span>
</div>

<div class="card">
  <input type="hidden" id="editKey">

  <label>åœ°å€é¡å‹</label>
  <select id="area"><option>åœ‹å…§</option><option>åœ‹å¤–</option></select>

  <label>åœ‹å®¶ / ç¸£å¸‚é„‰é®</label>
  <input id="place">

  <label>æ¨™é¡Œ</label>
  <input id="title">

  <label>è³‡æ–™å…§å®¹</label>
  <textarea id="content" rows="3"></textarea>

  <label>åƒè€ƒç¶²å€</label>
  <textarea id="links" rows="2"></textarea>

  <label>é—œéµå­—ï¼ˆé€—è™Ÿåˆ†éš”ï¼‰</label>
  <input id="tags">

  <label>æ˜¯å¦å·²åˆ°è¨ª</label>
  <select id="visited"><option>å¦</option><option>æ˜¯</option></select>

  <label>åˆ°è¨ªæ—¥æœŸï¼ˆYYYY/MM/DD æˆ– YYYY-MM-DDï¼‰</label>
  <input id="date" placeholder="2023/04/03">

  <label>éŠè¨˜å¿ƒå¾—</label>
  <textarea id="note" rows="3"></textarea>

  <button onclick="save()">ğŸ’¾ å„²å­˜</button>
</div>

<div class="card">
  <label>ğŸ” æœå°‹</label>
  <input id="search" oninput="render()">
</div>

<div class="card">
  <h2>ğŸ“š æˆ‘çš„æ—…éŠè³‡æ–™</h2>
  <div id="list"></div>
</div>

<script>
let currentTab="all";

/* âœ… å®‰å…¨è§£ææ—¥æœŸï¼ˆæ”¯æ´ YYYY/MM/DD & YYYY-MM-DDï¼‰ */
function parseDateSafe(str){
  if(!str) return null;
  const s = str.replace(/\//g,"-");
  const d = new Date(s);
  return isNaN(d) ? null : d;
}

/* å„²å­˜æç¤º */
function showSavedMessage(){
  saveMsg.style.display="block";
  setTimeout(()=>saveMsg.style.display="none",2000);
}

/* åˆ†é  */
function setTab(tab,el){
  currentTab=tab;
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  render();
}

/* æ¸…è¡¨å–® */
function clearForm(){
  editKey.value="";
  area.value="åœ‹å…§";
  place.value="";
  title.value="";
  content.value="";
  links.value="";
  tags.value="";
  visited.value="å¦";
  date.value="";
  note.value="";
}

/* å„²å­˜ */
function save(){
  const id=editKey.value||("travel-"+Date.now());
  const data={
    id,
    area:area.value,
    place:place.value,
    title:title.value,
    content:content.value,
    links:links.value,
    tags:tags.value,
    visited:visited.value,
    date:date.value.trim(),
    note:note.value
  };
  localStorage.setItem(id,JSON.stringify(data));
  clearForm();
  render();
  showSavedMessage();
}

/* é¡¯ç¤ºï¼‹æ’åº */
function render(){
  list.innerHTML="";
  const q=search.value||"";
  const items=[];

  for(let k in localStorage){
    if(k.startsWith("travel-")){
      items.push(JSON.parse(localStorage[k]));
    }
  }

  // â­ æ­£ç¢ºæ’åºé‚è¼¯
  items.sort((a,b)=>{
    const da=parseDateSafe(a.date);
    const db=parseDateSafe(b.date);

    if(da && db) return db-da;
    if(da) return -1;
    if(db) return 1;

    return Number(b.id.split("-")[1]) - Number(a.id.split("-")[1]);
  });

  items.forEach(d=>{
    if(currentTab==="åœ‹å…§"||currentTab==="åœ‹å¤–"){
      if(d.area!==currentTab) return;
    }
    if(currentTab==="æ˜¯"||currentTab==="å¦"){
      if(d.visited!==currentTab) return;
    }
    if(JSON.stringify(d).indexOf(q)===-1) return;

    list.innerHTML+=`
    <div class="item">
      <strong>${d.title}</strong>
      ${d.date?`<span class="date">ğŸ“… ${d.date}</span>`:""}
      <br>
      <span class="small">${d.area}ï½œ${d.place}</span><br>
      ${d.tags.split(",").filter(t=>t).map(t=>`<span class="tag">${t}</span>`).join("")}
      ${d.visited==="æ˜¯"?" âœ” å·²åˆ°è¨ª":""}
      <
