<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ—…éŠè³‡æ–™æ”¶é›†ç°¿</title>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;background:#f4f5f7;padding:16px;}
h1{text-align:center;}
.tab{display:inline-block;padding:6px 12px;margin:4px;border-radius:20px;background:#e0e0e0;cursor:pointer;}
.tab.active{background:#4CAF50;color:#fff;}
.card{background:#fff;border-radius:12px;padding:16px;margin-bottom:16px;box-shadow:0 2px 6px rgba(0,0,0,.08);}
label{font-weight:bold;display:block;margin-top:10px;}
input,select,textarea{width:100%;padding:8px;margin-top:4px;border-radius:6px;border:1px solid #ccc;}
button{margin-top:10px;padding:10px;width:100%;border:none;border-radius:8px;background:#4CAF50;color:#fff;font-size:16px;}
.item{border-bottom:1px dashed #ddd;padding:10px 0;font-size:14px;}
.tag{background:#e0f2f1;padding:2px 6px;border-radius:6px;margin-right:4px;font-size:12px;}
.small{font-size:12px;color:#666;}
.action{cursor:pointer;margin-right:8px;color:#1976d2;}
#saveMsg{display:none;text-align:center;color:#2e7d32;font-weight:bold;margin-bottom:10px;}
</style>
</head>

<body>

<h1>ğŸŒ æ—…éŠè³‡æ–™æ”¶é›†ç°¿</h1>
<div id="saveMsg">âœ… å·²å„²å­˜</div>

<div style="text-align:center">
  <span class="tab active" onclick="setTab('all',this)">å…¨éƒ¨</span>
  <span class="tab" onclick="setTab('åœ‹å…§',this)">åœ‹å…§</span>
  <span class="tab" onclick="setTab('åœ‹å¤–',this)">åœ‹å¤–</span>
  <span class="tab" onclick="setTab('æ˜¯',this)">å·²åˆ°è¨ª</span>
  <span class="tab" onclick="setTab('å¦',this)">æœªåˆ°è¨ª</span>
</div>

<div class="card">
  <input type="hidden" id="editKey">

  <label>åœ°å€é¡å‹</label>
  <select id="area"><option>åœ‹å…§</option><option>åœ‹å¤–</option></select>

  <label>åœ‹å®¶ / ç¸£å¸‚é„‰é®</label>
  <input id="place">

  <label>æ¨™é¡Œ</label>
  <input id="title">

  <label>è³‡æ–™å…§å®¹</label>
  <textarea id="content" rows="3"></textarea>

  <label>åƒè€ƒç¶²å€</label>
  <textarea id="links" rows="2"></textarea>

  <label>é—œéµå­—ï¼ˆé€—è™Ÿåˆ†éš”ï¼‰</label>
  <input id="tags">

  <label>æ˜¯å¦å·²åˆ°è¨ª</label>
  <select id="visited"><option>å¦</option><option>æ˜¯</option></select>

  <label>åˆ°è¨ªæ—¥æœŸ</label>
  <input type="date" id="date">

  <label>éŠè¨˜å¿ƒå¾—</label>
  <textarea id="note" rows="3"></textarea>

  <button onclick="save()">ğŸ’¾ å„²å­˜</button>
</div>

<div class="card">
  <label>ğŸ” æœå°‹</label>
  <input id="search" oninput="render()">
</div>

<div class="card">
  <h2>ğŸ“š æˆ‘çš„æ—…éŠè³‡æ–™</h2>
  <div id="list"></div>
</div>

<div class="card">
  <h2>ğŸ“¦ åŒ¯å‡º / åŒ¯å›</h2>
  <button onclick="backupJSON()">ğŸ“¤ å‚™ä»½ JSON</button>
  <button onclick="exportExcel()">ğŸ“Š åŒ¯å‡º Excel</button>
  <input type="file" id="importExcel" accept=".xlsx" onchange="importExcel()">
</div>

<script>
let currentTab="all";

/* å„²å­˜æç¤º */
function showSavedMessage(){
  saveMsg.style.display="block";
  setTimeout(()=>saveMsg.style.display="none",2000);
}

/* åˆ†é  */
function setTab(tab,el){
  currentTab=tab;
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  render();
}

/* è¡¨å–® */
function clearForm(){
  editKey.value="";
  area.value="åœ‹å…§";
  place.value="";
  title.value="";
  content.value="";
  links.value="";
  tags.value="";
  visited.value="å¦";
  date.value="";
  note.value="";
}

function save(){
  const id=editKey.value||("travel-"+Date.now());
  const data={id,area:area.value,place:place.value,title:title.value,
    content:content.value,links:links.value,tags:tags.value,
    visited:visited.value,date:date.value,note:note.value};
  localStorage.setItem(id,JSON.stringify(data));
  clearForm(); render(); showSavedMessage();
}

/* é¡¯ç¤ºï¼ˆé‡é»ï¼šæ’åºï¼‰ */
function render(){
  list.innerHTML="";
  const q=search.value||"";
  const items=[];

  for(let k in localStorage){
    if(k.startsWith("travel-")){
      const d=JSON.parse(localStorage[k]);
      items.push(d);
    }
  }

  // â­ æ’åºé‚è¼¯ï¼ˆæ–° â†’ èˆŠï¼‰
  items.sort((a,b)=>{
    const da = a.date ? new Date(a.date) : new Date(Number(a.id.split("-")[1]));
    const db = b.date ? new Date(b.date) : new Date(Number(b.id.split("-")[1]));
    return db - da;
  });

  items.forEach(d=>{
    if(currentTab==="åœ‹å…§"||currentTab==="åœ‹å¤–"){
      if(d.area!==currentTab) return;
    }
    if(currentTab==="æ˜¯"||currentTab==="å¦"){
      if(d.visited!==currentTab) return;
    }
    if(JSON.stringify(d).indexOf(q)===-1) return;

    list.innerHTML+=`
    <div class="item">
      <strong>${d.title}</strong><br>
      <span class="small">${d.area}ï½œ${d.place}${d.date?"ï½œ"+d.date:""}</span><br>
      ${d.tags.split(",").filter(t=>t).map(t=>`<span class="tag">${t}</span>`).join("")}
      ${d.visited==="æ˜¯"?"âœ” å·²åˆ°è¨ª":""}
      <div class="small">
        <span class="action" onclick="editItem('${d.id}')">âœï¸ ç·¨è¼¯</span>
        <span class="action" onclick="removeItem('${d.id}')">ğŸ—‘ åˆªé™¤</span>
        <a href="https://www.google.com/maps/search/${encodeURIComponent(d.place)}" target="_blank">ğŸ“ åœ°åœ–</a>
      </div>
    </div>`;
  });
}

function editItem(key){
  const d=JSON.parse(localStorage[key]);
  editKey.value=d.id;
  area.value=d.area; place.value=d.place; title.value=d.title;
  content.value=d.content; links.value=d.links;
  tags.value=d.tags; visited.value=d.visited;
  date.value=d.date; note.value=d.note;
  window.scrollTo({top:0,behavior:"smooth"});
}

function removeItem(key){
  if(confirm("ç¢ºå®šåˆªé™¤ï¼Ÿ")){
    localStorage.removeItem(key); render();
  }
}

/* åŒ¯å‡º / åŒ¯å›ï¼ˆä¿æŒåŸé‚è¼¯ï¼‰ */
function backupJSON(){
  const arr=[];
  for(let k in localStorage){
    if(k.startsWith("travel-")) arr.push(JSON.parse(localStorage[k]));
  }
  const blob=new Blob(["\uFEFF"+JSON.stringify(arr,null,2)],{type:"application/json"});
  download(blob,"travel_backup.json");
}

function exportExcel(){
  const rows=[["id","åœ°å€","åœ°é»","æ¨™é¡Œ","å…§å®¹","ç¶²å€","é—œéµå­—","æ˜¯å¦åˆ°è¨ª","åˆ°è¨ªæ—¥æœŸ","å¿ƒå¾—"]];
  for(let k in localStorage){
    if(k.startsWith("travel-")){
      const d=JSON.parse(localStorage[k]);
      rows.push([d.id,d.area,d.place,d.title,d.content,d.links,d.tags,d.visited,d.date,d.note]);
    }
  }
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,XLSX.utils.aoa_to_sheet(rows),"æ—…éŠè³‡æ–™");
  XLSX.writeFile(wb,"æ—…éŠè³‡æ–™.xlsx");
}

function importExcel(){
  const file=importExcel.files[0];
  const r=new FileReader();
  r.onload=e=>{
    const wb=XLSX.read(new Uint8Array(e.target.result),{type:"array"});
    const rows=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]],{header:1});
    rows.slice(1).forEach(r=>{
      const d={id:r[0]||("travel-"+Date.now()+Math.random()),
        area:r[1]||"",place:r[2]||"",title:r[3]||"",
        content:r[4]||"",links:r[5]||"",tags:r[6]||"",
        visited:r[7]||"å¦",date:r[8]||"",note:r[9]||""};
      localStorage.setItem(d.id,JSON.stringify(d));
    });
    render(); alert("Excel åŒ¯å›å®Œæˆ");
  };
  r.readAsArrayBuffer(file);
}

function download(blob,name){
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download=name; a.click();
}

render();
</script>

</body>
</html>
